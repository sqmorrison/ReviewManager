<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="/logo.png" />
    <title>Register</title>
</head>
<body class="bg-radial from-secondary to-accent h-screen overflow-x-hidden">
    <!--Navbar for website splash page, login page, register-->
    <div class="navbar bg-accent shadow-sm">
        <div class="navbar-start">
          <div class="dropdown">
            <div tabindex="0" role="button" class="btn btn-ghost lg:hidden">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h8m-8 6h16" /> </svg>
            </div>
            <ul
              tabindex="0"
              class="menu menu-sm dropdown-content bg-base-100 rounded-box z-1 mt-3 w-52 p-2 shadow">
              <li><a>How to use</a></li>
              <li><a>Register</a></li>
            </ul>
          </div>
          <a class="btn btn-ghost text-white text-xl" href="index.html">
            <figure>
                <img
                src="/logo.png"
                alt="JQReview Logo"
                class="w-16 h-12 rounded-full"
                />
            </figure>
            JQReview</a>
        </div>
        <div class="navbar-center hidden lg:flex">
          <ul class="menu menu-horizontal px-1">
            <li><a class="text-white text-lg font-sans" href="/index.html#sectionHowToUse">How to use</a></li>
            <li><a class="text-white text-lg font-sans" href="/pages/register.html">Register</a></li>
          </ul>
        </div>
        <div class="navbar-end">
            <label class="swap swap-rotate text-white">
                <!-- this hidden checkbox controls the state -->
                <input type="checkbox" class="theme-controller" value="lofi"/>
              
                <!-- sun icon -->
                <svg
                  class="swap-off h-10 w-10 fill-current"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24">
                  <path
                    d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z" />
                </svg>
              
                <!-- moon icon -->
                <svg
                  class="swap-on h-10 w-10 fill-current"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24">
                  <path
                    d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z" />
                </svg>
              </label>
          <a class="btn btn-ghost text-xl text-white" href="/pages/login.html">
            Login
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
              <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
              <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
            </svg>
          </a>
        </div>
      </div>

      <!-- Initial card asking for instructor vs student registration-->
      <form id="frmWhoAreYou" class="flex flex-col items-center justify-center mt-24">
        <h1 class="text-2xl text-white font-bold font-sans mt-12">Let's Get You Registered!</h1>
        <h1 class="text-lg text-white font-sans mt-1">note: students can later be instructors and vice versa</h1>
        <div  class="card bg-base-100 text-base-content w-96 mt-4">
            <div class="card-body items-center text-center">
              <h2 class="card-title">Who are you?</h2>
              <p class="font-sans font-bold">Please select if you are a student or instructor</p>
              <div class="card-actions justify-end">
                <button type="button" id="btnStudent" class="btn btn-primary">Student</button>
                <button type="button" id="btnInstructor" class="btn btn-secondary text-white">Instructor</button>
              </div>
            </div>
          </div>
        </form>

        <!-- Instructor Registration flow-->
        <form id="frmInstructorRegister" class="mt-4 hidden">
            <h1 class="text-xl font-bold text-white">Instructor Registration</h1>
            <!--Progress bar for instructor registration-->
            <ul class="steps steps-horizontal text-white">
                <li id="prgStep1" class="step step-secondary">Account Info</li>
                <li id="prgStep2" class="step">Confirm Email</li>
                <li id="prgStep3" class="step">Select Courses</li>
                <li id="prgStep4" class="step">Complete</li>
            </ul>

            <!--First page for instructor registration-->
            <form id="frmInstructorFirstPage">
                <fieldset id="frmInstructorFirstPage" class="fieldset w-xs bg-base-100 border border-base-300 p-4 rounded-box">
                    <label class="fieldset-label">First/Last Name</label>
                    <input type="text" name="strInFullName" class="input input-accent" placeholder="John Smith" />

                    <label class="fieldset-label">Prefix</label>
                    <input type="text" class="input input-accent" placeholder="eg Professor, Mrs, Mr, etc" />

                    <label class="fieldset-label">Email</label>
                    <input type="email" name="strInEmail" class="input input-accent validator" placeholder="Email" />
                    
                    <label class="fieldset-label">Password</label>
                    <input type="password" name="strInPass" class="input input-accent " placeholder="Password" />
                
                    <label class="fieldset-label">Confirm Password</label>
                    <input type="password" name="strInConfPass" class="input input-accent " placeholder="Confirm Password" />
                    
                    <label class="fieldset-label">School/University </label>
                    <input type="text" class="input input-accent " placeholder="ex: Tennesee Tech" />
                    
                    <button type="submit" id="btnInstructorRegister" class="btn btn-primary text-white mt-4">Register</button>
                </fieldset>
                <button type="button" id="btnInstructorGoBack" class="btn btn-base-100 mt-1">Go Back</button>
              </form>

            <div id="frmInstructorSecondPage" class="mt-4 hidden card bg-base-100 w-96 shadow-sm">
                <div class="card bg-base-100 w-96 shadow-sm">
                    <div class="card-body">
                      <h2 class="card-title">Confirm Email</h2>
                      <p>Please Enter your confirmation code found at your email</p>
                      <input type="text" class="input input-accent" placeholder="ex 112233"/>
                      <button type="button" id="btnInstructorConfirmEmail" class="btn btn-primary text-white mt-1">Confirm Code</button>
                    </div>
                  </div>
            </div>

            <div id="frmInstructorThirdPage" class="mt-4 hidden">
                <div class="card bg-base-100 w-96 shadow-sm">
                    <div class="card-body">
                      <h2 class="card-title">How many classes will you use JQReview for?</h2>
                      <p>Note: one Instructor may only use this product for up to 5 classes a semester by default</p>
                      <p>If more classes are needed, please consult how to use</p>
                      <select id="selNumClasses" class="select">
                        <option disabled selected>Number of Classes</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                      </select>
                      <button type="button" id="btnInstructorConfirmNumClasses" class="btn btn-primary text-white mt-1">Confirm Classes</button>
                    </div>
                </div>
            </div>

            <div id="frmInstructorFourthPage" class="mt-4 hidden">
              <div class="card bg-base-100 w-96 shadow-sm">
                <div class="card-body">
                  <h2 class="card-title">What are you classes called?</h2>
                  <div id="inputFields">

                  </div>
                  <button type="button" id="btnInstructorConfirmClassNames" class="btn btn-primary text-white mt-1">Confirm Names</button>
                </div>
              </div>
            </div>

            <div id="frmInstructorFifthPage"  class="mt-4 hidden">
              <div class="card bg-base-100 w-96 shadow-sm">
                <div class="card-body">
                  <h2 class="card-title">Complete!</h2>
                  <p>You can find your class codes inside the class section when you login!</p>
                  <a type="button" class="btn btn-primary text-white mt-1" href="/pages/login.html">Login</a>
                </div>
              </div>
            </div>

        </form>
        
        <!-- Student Registration -->
        <form id="frmStudentRegister" class="mt-24 hidden">
            <h1 class="text-xl font-bold font-sans text-white">Student Registration</h1>
            <fieldset class="fieldset w-xs bg-base-100 border border-base-300 p-4 rounded-box">   
                <label class="fieldset-label">First/Last Name</label>
                <input type="text" name="strFullName" class="input input-accent" placeholder="John Smith" />

                <label class="fieldset-label">Email</label>
                <input type="email" name="strEmail" class="input input-accent validator" placeholder="Email" />
                
                <label class="fieldset-label">Password</label>
                <input type="password" name="strPassword" class="input input-accent " placeholder="Password" />
            
                <label class="fieldset-label">Confirm Password</label>
                <input type="password" name="strConfirmPass" class="input input-accent " placeholder="Confirm Password" />
                
                <label class="fieldset-label">Class Code (optional)</label>
                <input type="text" name="strClassCode" class="input input-accent " placeholder="ex: 003885" />
                
                <button type="submit" id="btnStudentRegister" class="btn btn-primary text-white mt-4">Register</button>
              </fieldset>
            <button type="button" id="btnStudentGoBack" class="btn btn-base-100 mt-2 mr-54">Go Back</button>
        </form>

        <div id="frmStudentSuccessPage"  class="mt-24 hidden">
          <div class="card bg-base-100 w-96 shadow-sm">
            <div class="card-body">
              <h2 class="card-title">Complete!</h2>
              <p>You can add classes inside the class section when you login!</p>
              <a type="button" class="btn btn-primary text-white mt-1" href="/pages/login.html">Login</a>
            </div>
          </div>
        </div>

      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <script type="module" src="/src/main.js"></script>
      <script>
        //initial index of first step (id="prgStep1")
        var intIndex = 1;

        //variable to track how many classes a professor has selected
        var intInstructorClassNum = 0;

        //update intIndex position by moving up a step
        function inc(){
            intIndex += 1;
        }
        //function for keeping adding input fields based on num classes by an instructor
        function classGenerator(intInstructorClassNum) {
      let temp = "";

      for (let i = 0; i < intInstructorClassNum; i++) {
          temp += `
              <div class="class-input-group mt-4">
                  <input 
                      type="text" 
                      class="input input-accent mt-1" 
                      id="inputCourseName${i + 1}" 
                      name="strCourseName${i + 1}" 
                      placeholder="Course Name ${i + 1}" 
                  />
                  <input 
                      type="text" 
                      class="input input-accent mt-1" 
                      id="inputCourseNumber${i + 1}" 
                      name="strCourseNumber${i + 1}" 
                      placeholder="Course Number ${i + 1}" 
                  />
                  <input 
                      type="text" 
                      class="input input-accent mt-1" 
                      id="inputCourseSection${i + 1}" 
                      name="strCourseSection${i + 1}" 
                      placeholder="Course Section ${i + 1}" 
                  />
                  <input 
                      type="text" 
                      class="input input-accent mt-1" 
                      id="inputCourseTerm${i + 1}" 
                      name="strCourseTerm${i + 1}" 
                      placeholder="Course Term ${i + 1}" 
                  />
                  <input 
                      type="date" 
                      class="input input-accent mt-1" 
                      id="inputStartDate${i + 1}" 
                      name="strStartDate${i + 1}" 
                      placeholder="Start Date ${i + 1}" 
                  />
                  <input 
                      type="date" 
                      class="input input-accent mt-1" 
                      id="inputEndDate${i + 1}" 
                      name="strEndDate${i + 1}" 
                      placeholder="End Date ${i + 1}" 
                  />
              </div>
          `;
        }

          $('#inputFields').append(temp);
      }


        //function for adding progress to progress bar
        function stepUp(intIndex){
            switch(intIndex){
                case 2:
                    $('#prgStep2').addClass("step-secondary");
                    $('#frmInstructorFirstPage').hide();
                    $('#frmInstructorSecondPage').fadeIn();
                    break;
                case 3:
                    $('#prgStep3').addClass("step-secondary");
                    $('#frmInstructorSecondPage').hide();
                    $('#frmInstructorThirdPage').fadeIn();
                    break;
                case 4:
                    $('#prgStep4').addClass("step-secondary");
                    $('#frmInstructorFourthPage').hide();
                    $('#frmInstructorFifthPage').fadeIn();
                    break;
            }
        }

        $('#btnInstructorConfirmNumClasses').on('click', function () {
          $('#frmInstructorThirdPage').hide();
          intInstructorClassNum = $('#selNumClasses').find(":selected").val();
          classGenerator(intInstructorClassNum);
          $('#frmInstructorFourthPage').fadeIn();
        })

        $('#btnInstructorConfirmClassNames').on('click', async function () {
            let strEmail = sessionStorage.getItem('strInEmail');
            let arrCourses = [];

            for (let i = 0; i < intInstructorClassNum; i++) {
                let strCourseName = $(`#inputCourseName${i + 1}`).val();
                let strCourseNumber = $(`#inputCourseNumber${i + 1}`).val();
                let strCourseSection = $(`#inputCourseSection${i + 1}`).val();
                let strCourseTerm = $(`#inputCourseTerm${i + 1}`).val();
                let strStartDate = $(`#inputStartDate${i + 1}`).val();
                let strEndDate = $(`#inputEndDate${i + 1}`).val();

                arrCourses.push({
                    strCourseName,
                    strCourseNumber,
                    strCourseSection,
                    strCourseTerm,
                    strStartDate,
                    strEndDate
                });
            };

            try {
                const response = await fetch('/instructorCourseRegister', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        strEmail,
                        arrCourses
                    })
                });

                const result = await response.text();
                alert(result); // Show success message or redirect
            } catch (err) {
                console.error('Submission failed:', err);
                alert('Failed to register');
            }

            inc();
            stepUp(intIndex);
        })

        document.getElementById('frmInstructorRegister').addEventListener('submit', async function (e) {
            e.preventDefault(); // Prevent the form from navigating away

            const form = e.target;
            const formData = new FormData(form);

            const data = {
                strInFullName: formData.get('strInFullName'),
                strInEmail: formData.get('strInEmail'),
                strInPass: formData.get('strInPass'),
                strInConfPass: formData.get('strInConfPass'),
            };

            if (data.strInPass !== data.strInConfPass) {
                alert("Passwords do not match!");
                return;
            }

            if (!data.strInFullName || !data.strInEmail || !data.strInPass || !data.strInConfPass) {
                alert("Please fill in all fields!");
                return;
            }
            console.log(data); // For debugging

            try {
                const response = await fetch('/instructorRegister', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.text();
                alert(result); // Show success message or redirect
                inc();
                stepUp(intIndex);
                sessionStorage.setItem('strInEmail', data.strInEmail);
            } catch (err) {
                console.error('Submission failed:', err);
                alert('Failed to register');
            }
        });

        $('#btnInstructorConfirmEmail').on('click', function () {
            inc();
            stepUp(intIndex);
        })

        $('#btnInstructor').on('click', function () {
            $('#frmWhoAreYou').hide(); 
            $('#frmInstructorRegister').removeClass("hidden").addClass("flex flex-col items-center justify-center").fadeIn();
        });

        $('#btnStudent').on('click', function () {
            $('#frmWhoAreYou').hide();
            $('#frmStudentRegister').removeClass("hidden").addClass("flex flex-col items-center justify-center").fadeIn();
        });

        $('#btnStudentGoBack').on('click', function () {
            $('#frmWhoAreYou').fadeIn(); 
            $('#frmStudentRegister').hide();
        });

        $('#btnInstructorGoBack').on('click', function () {
            $('#frmWhoAreYou').fadeIn(); 
            $('#frmInstructorFirstPage').fadeIn();
            $('#frmInstructorSecondPage').hide();
            $('#frmInstructorThirdPage').hide();
            $('#frmInstructorFourthPage').hide();
            $('#frmInstructorFifthPage').hide();
            $('#frmInstructorRegister').hide();
        });
      </script>
      <!--Javascript for sending info to the backend-->
      <script>
        document.getElementById('frmStudentRegister').addEventListener('submit', async function (e) {
          e.preventDefault(); // Prevent the form from navigating away
        
          const form = e.target;
          const formData = new FormData(form);
        
          const data = {
            strFullName: formData.get('strFullName'),
            strEmail: formData.get('strEmail'),
            strPassword: formData.get('strPassword'),
            strConfirmPass: formData.get('strConfirmPass'),
            strClassCode: formData.get('strClassCode')
          };
        
          try {
            const response = await fetch('/studentRegister', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(data)
            });
        
            const result = await response.text();
            $('#frmStudentRegister').hide();
            $('#frmStudentSuccessPage').removeClass("hidden").addClass("flex flex-col items-center justify-center").fadeIn();
          } catch (err) {
            console.error('Submission failed:', err);
            //make this a sweet alert
            alert('Failed to register, please make sure all fields are filled out correctly');
          }
        });
        </script>
        
</body>
</html>